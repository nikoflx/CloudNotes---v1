<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudNotes v1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #fafafa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f0f0f5;
            --text-primary: #1a1a1a;
            --text-secondary: #6b7280;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --accent-light: rgba(99, 102, 241, 0.1);
            --border: #e5e7eb;
            --shadow: rgba(0, 0, 0, 0.08);
            --shadow-hover: rgba(99, 102, 241, 0.2);
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        [data-theme="dark"] {
            --bg-primary: #0f0f0f;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #262626;
            --text-primary: #f5f5f5;
            --text-secondary: #9ca3af;
            --accent: #818cf8;
            --accent-hover: #6366f1;
            --accent-light: rgba(129, 140, 248, 0.15);
            --border: #2d2d2d;
            --shadow: rgba(0, 0, 0, 0.4);
            --shadow-hover: rgba(129, 140, 248, 0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            transition: background 0.4s cubic-bezier(0.4, 0, 0.2, 1), color 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 2px 0 10px var(--shadow);
        }

        .sidebar-header {
            padding: 30px 24px 20px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, var(--accent-light), transparent);
        }

        .app-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 6px;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .app-author {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        /* New 'Why Us?' Button Style */
        .sidebar-header-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .why-us-btn {
            display: block;
            width: 100%;
            padding: 10px 18px;
            border: none;
            border-radius: 10px;
            background: var(--bg-primary);
            color: var(--accent);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid var(--accent);
            box-shadow: 0 2px 8px var(--shadow-hover);
            text-align: center;
        }

        .why-us-btn:hover {
            background: var(--accent);
            color: var(--bg-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px var(--shadow-hover);
        }

        .why-us-btn:active {
            transform: translateY(0);
        }
        /* End New 'Why Us?' Button Style */

        .toolbar {
            padding: 20px;
            display: flex;
            gap: 12px;
            border-bottom: 1px solid var(--border);
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 10px;
            background: var(--accent);
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px var(--shadow);
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px var(--shadow-hover);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-icon {
            padding: 10px 14px;
            font-size: 18px;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .folders-container {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .folders-container::-webkit-scrollbar {
            width: 6px;
        }

        .folders-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 10px;
        }

        .folder-item {
            padding: 14px 18px;
            margin: 6px 0;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border: 2px solid transparent;
        }

        .folder-item:hover {
            background: var(--bg-tertiary);
            transform: translateX(6px);
            border-color: var(--accent-light);
        }

        .folder-item.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 12px var(--shadow-hover);
            transform: translateX(6px);
        }

        .folder-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .folder-item:hover .folder-icon {
            transform: scale(1.15) rotate(5deg);
        }

        .folder-name {
            flex: 1;
            font-weight: 600;
            font-size: 15px;
        }

        .folder-count {
            font-size: 13px;
            opacity: 0.8;
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .topbar {
            padding: 20px 40px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 50px 12px 20px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px var(--accent-light);
        }

        .search-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-secondary);
        }

        .topbar-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .theme-toggle {
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--bg-primary);
            cursor: pointer;
            font-size: 22px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            border-color: var(--accent);
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            background: var(--bg-primary);
        }

        .content-area::-webkit-scrollbar {
            width: 8px;
        }

        .content-area::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 10px;
        }

        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
        }

        .note-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid var(--border);
            animation: fadeIn 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .note-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), #8b5cf6);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .note-card:hover::before {
            transform: scaleX(1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .note-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 32px var(--shadow);
            border-color: var(--accent);
        }

        .note-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .note-preview {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .note-meta {
            padding-top: 16px;
            border-top: 1px solid var(--border);
            font-size: 13px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .note-badge {
            background: var(--accent-light);
            color: var(--accent);
            padding: 4px 12px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 12px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 20px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--accent-light);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
        }

        .close-btn {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: var(--danger);
            border-color: var(--danger);
            transform: scale(1.1) rotate(90deg);
        }

        .modal-body {
            padding: 32px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-body::-webkit-scrollbar {
            width: 8px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 10px;
        }
        
        /* Why Us Section Styles */
        .why-us-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 30px;
        }

        .why-us-card {
            background: var(--bg-primary);
            padding: 30px;
            border-radius: 16px;
            border: 2px solid var(--border);
            box-shadow: 0 4px 12px var(--shadow);
            transition: transform 0.3s;
        }

        .why-us-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .why-us-card h4 {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .why-us-card p {
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-secondary);
        }
        /* End Why Us Section Styles */

        /* NEW UPGRADE/PRICING STYLES */
        .upgrade-pricing {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 40px;
            margin-bottom: 40px;
        }

        .price-card {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 16px;
            border: 2px solid var(--border);
            text-align: center;
            max-width: 300px;
            box-shadow: 0 8px 20px var(--shadow);
            transition: transform 0.3s, border-color 0.3s;
        }

        .price-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .price-card.annual {
            background: var(--accent-light);
            border-color: var(--accent);
            transform: scale(1.05);
            box-shadow: 0 10px 30px var(--shadow-hover);
        }

        .price-card.annual:hover {
            transform: scale(1.08);
        }

        .plan-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--accent);
        }

        .plan-price {
            font-size: 48px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .plan-duration {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .save-badge {
            display: inline-block;
            padding: 5px 15px;
            background: var(--warning);
            color: white;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .plan-details {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .buy-btn {
            display: block;
            width: 100%;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            background: var(--accent);
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.3s;
        }

        .buy-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            border: 2px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .comparison-table th, .comparison-table td {
            padding: 15px;
            text-align: left;
            border: 1px solid var(--border);
            font-size: 15px;
        }

        .comparison-table th {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-weight: 700;
        }

        .comparison-table tr:nth-child(even) {
            background: var(--bg-primary);
        }

        .comparison-table tr:nth-child(odd) {
            background: var(--bg-secondary);
        }

        .comparison-table td:nth-child(1) {
            font-weight: 600;
        }

        .free-feature {
            color: var(--text-secondary);
        }

        .pro-feature {
            color: var(--success);
            font-weight: 700;
        }

        .no-feature {
            color: var(--danger);
            font-weight: 500;
        }
        /* END NEW UPGRADE/PRICING STYLES */

        .editor-toolbar {
            display: flex;
            gap: 12px;
            padding: 18px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            border: 2px solid var(--border);
        }

        .editor-toolbar select,
        .editor-toolbar input[type="number"] {
            padding: 10px 14px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .editor-toolbar select:focus,
        .editor-toolbar input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .editor-toolbar button {
            padding: 10px 18px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .editor-toolbar button:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .note-input {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 18px;
            margin-bottom: 20px;
            font-family: inherit;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .note-editor {
            width: 100%;
            min-height: 350px;
            padding: 18px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 16px;
            line-height: 1.7;
            resize: vertical;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .note-editor:focus,
        .note-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px var(--accent-light);
        }

        .canvas-container {
            margin: 24px 0;
            border: 2px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 16px var(--shadow);
        }

        #drawingCanvas {
            display: block;
            width: 100%;
            height: 400px;
            cursor: crosshair;
            background: white;
        }

        .canvas-toolbar {
            padding: 16px;
            background: var(--bg-tertiary);
            display: flex;
            gap: 12px;
            align-items: center;
            border-top: 2px solid var(--border);
        }

        .canvas-toolbar button {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .canvas-toolbar input[type="color"] {
            width: 50px;
            height: 40px;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
        }

        .canvas-toolbar input[type="range"] {
            width: 120px;
        }

        .attachments-section {
            margin-top: 28px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .attachments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .attachment-item {
            padding: 20px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid var(--border);
        }

        .attachment-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow);
            border-color: var(--accent);
        }

        .attachment-icon {
            font-size: 38px;
            margin-bottom: 12px;
            filter: drop-shadow(0 2px 4px var(--shadow));
        }

        .attachment-name {
            font-size: 13px;
            word-break: break-all;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
        }

        .empty-icon {
            font-size: 80px;
            margin-bottom: 24px;
            opacity: 0.6;
            filter: drop-shadow(0 4px 8px var(--shadow));
        }

        .empty-text {
            font-size: 20px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        input[type="file"] {
            display: none;
        }

        .color-picker-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px var(--shadow);
        }

        .color-option:hover {
            transform: scale(1.15);
        }

        .color-option.selected {
            border-color: var(--text-primary);
            box-shadow: 0 0 0 4px var(--accent-light);
            transform: scale(1.15);
        }

        .stat-item {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
            font-weight: 600;
        }

        .bookmark-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            filter: grayscale(1);
        }

        .bookmark-btn.bookmarked {
            filter: grayscale(0);
            transform: scale(1.2);
        }

        .save-indicator {
            padding: 12px 20px;
            background: var(--success);
            color: white;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            animation: fadeIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .clipboard-section {
            margin-top: 28px;
            padding: 20px;
            background: var(--accent-light);
            border-radius: 12px;
            border: 2px solid var(--accent);
        }

        .clipboard-preview {
            margin-top: 12px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-secondary);
            max-height: 100px;
            overflow-y: auto;
        }
    </style>
</head>
<body data-theme="light">
    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="app-title" data-i18n="appTitle">CloudNotes v1</div>
                <div class="app-author" data-i18n="appAuthor">by Niko</div>
                
                <div style="margin-bottom: 15px;">
                    <label for="langSelect" style="font-size: 13px; color: var(--text-secondary); font-weight: 500;">Language:</label>
                    <select id="langSelect" onchange="switchLanguage(this.value)" style="padding: 5px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-primary); color: var(--text-primary);">
                        <option value="en">English</option>
                        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                    </select>
                </div>
                <div class="sidebar-header-buttons">
                    <button class="why-us-btn" data-i18n="whyUsBtn" onclick="openWhyUsModal()">Why Us?</button>
                    <button class="why-us-btn" style="border-color: var(--warning); color: var(--warning);" data-i18n="upgradeBtn" onclick="openUpgradeModal()">‚ú® Upgrade to Pro</button>
                </div>
            </div>
            
            <div class="toolbar">
                <button class="btn" data-i18n="folderBtn" onclick="createFolder()">+ Folder</button>
                <button class="btn btn-icon" data-i18n="newNoteIcon" onclick="openNewNote()">üìù</button>
            </div>

            <div class="folders-container" id="foldersContainer">
                </div>
        </div>

        <div class="main-content">
            <div class="topbar">
                <div class="search-bar">
                    <input type="text" data-i18n="searchPlaceholder" placeholder="Search notes..." id="searchInput" oninput="searchNotes()">
                    <span class="search-icon">üîç</span>
                </div>
                <div class="topbar-actions">
                    <div class="stat-item">
                        <span class="stat-value" id="totalNotes">0</span>
                        <div class="stat-label" id="totalNotesLabel" data-i18n="totalNotesLabel">Total Notes</div>
                    </div>
                    <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">üåô</button>
                </div>
            </div>

            <div class="content-area" id="contentArea">
                <div class="empty-state">
                    <div class="empty-icon">üìù</div>
                    <div class="empty-text" data-i18n="emptySelectFolder">Select a folder or create a new note</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="noteModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle" data-i18n="newNoteTitle">New Note</div>
                <button class="close-btn" onclick="closeNoteModal()">√ó</button>
            </div>
            <div class="modal-body">
                <input type="text" class="note-input" id="noteTitle" data-i18n="noteTitlePlaceholder" placeholder="‚ú® Note title...">
                
                <div class="editor-toolbar">
                    <select id="fontFamily" onchange="updateEditorStyle()">
                        <option value="Arial">Arial</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Courier New">Courier New</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Comic Sans MS">Comic Sans MS</option>
                        <option value="Brush Script MT">Brush Script</option>
                        <option value="Trebuchet MS">Trebuchet</option>
                    </select>
                    
                    <input type="number" id="fontSize" value="16" min="10" max="48" onchange="updateEditorStyle()" placeholder="Size">
                    
                    <button onclick="toggleDrawing()" data-i18n="drawBtn">üé® Draw</button>
                    <button onclick="document.getElementById('imageUpload').click()" data-i18n="imageBtn">üñºÔ∏è Image</button>
                    <button onclick="document.getElementById('fileUpload').click()" data-i18n="fileBtn">üìé File</button>
                    <button onclick="pasteFromClipboard()" class="btn-warning" data-i18n="pasteClipboardBtn">üìã Paste Clipboard</button>
                    <button onclick="toggleBookmark()" id="bookmarkBtn" data-i18n="bookmarkBtn">‚≠ê Bookmark</button>
                    <button onclick="saveNote()" class="btn btn-success" data-i18n="saveNoteBtn">üíæ Save Note</button>
                </div>

                <textarea class="note-editor" id="noteContent" data-i18n="noteContentPlaceholder" placeholder="‚úçÔ∏è Start writing your amazing ideas..."></textarea>

                <div class="canvas-container" id="canvasContainer" style="display: none;">
                    <canvas id="drawingCanvas"></canvas>
                    <div class="canvas-toolbar">
                        <button onclick="clearCanvas()" style="background: var(--danger); color: white;" data-i18n="clearCanvasBtn">üóëÔ∏è Clear</button>
                        <button onclick="saveDrawing()" class="btn-success" style="background: var(--success); color: white;" data-i18n="saveDrawingBtn">üíæ Save Drawing</button>
                        <input type="color" id="drawColor" value="#6366f1">
                        <label style="color: var(--text-secondary); font-size: 13px; font-weight: 600;">Brush Size:</label>
                        <input type="range" id="drawSize" min="1" max="30" value="3">
                        <span id="drawingStatus"></span>
                    </div>
                </div>

                <div class="clipboard-section" id="clipboardSection" style="display: none;">
                    <h3 class="section-title" data-i18n="clipboardTitle">üìã Clipboard Content</h3>
                    <div class="clipboard-preview" id="clipboardPreview"></div>
                    <button class="btn" style="margin-top: 12px;" onclick="insertClipboard()" data-i18n="insertClipboardBtn">‚ú® Insert into Note</button>
                </div>

                <div class="attachments-section">
                    <h3 class="section-title" data-i18n="attachmentsTitle">üìé Attachments</h3>
                    <div class="attachments-grid" id="attachmentsGrid"></div>
                </div>

                <input type="file" id="imageUpload" accept="image/*" onchange="addImage()" multiple>
                <input type="file" id="fileUpload" onchange="addFile()" multiple>
            </div>
        </div>
    </div>

    <div class="modal" id="folderModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <div class="modal-title" data-i18n="newFolderTitle">‚ú® New Folder</div>
                <button class="close-btn" onclick="closeFolderModal()">√ó</button>
            </div>
            <div class="modal-body">
                <input type="text" class="note-input" id="folderName" data-i18n="folderNamePlaceholder" placeholder="üìÅ Folder name...">
                
                <h3 class="section-title" data-i18n="colorTitle">üé® Choose Icon Color</h3>
                <div class="color-picker-container">
                    <div class="color-option selected" style="background: #6366f1;" data-color="#6366f1" onclick="selectColor(this)"></div>
                    <div class="color-option" style="background: #10b981;" data-color="#10b981" onclick="selectColor(this)"></div>
                    <div class="color-option" style="background: #f59e0b;" data-color="#f59e0b" onclick="selectColor(this)"></div>
                    <div class="color-option" style="background: #ef4444;" data-color="#ef4444" onclick="selectColor(this)"></div>
                    <div class="color-option" style="background: #8b5cf6;" data-color="#8b5cf6" onclick="selectColor(this)"></div>
                    <div class="color-option" style="background: #ec4899;" data-color="#ec4899" onclick="selectColor(this)"></div>
                    <div class="color-option" style="background: #06b6d4;" data-color="#06b6d4" onclick="selectColor(this)"></div>
                    <div class="color-option" style="background: #84cc16;" data-color="#84cc16" onclick="selectColor(this)"></div>
                </div>

                <button class="btn" style="margin-top: 28px; width: 100%;" onclick="saveFolderModal()" data-i18n="createFolderBtn">‚ú® Create Folder</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="whyUsModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title" data-i18n="whyUsModalTitle">üåü Why Choose CloudNotes v1?</div>
                <button class="close-btn" onclick="closeWhyUsModal()">√ó</button>
            </div>
            <div class="modal-body">
                <h2 style="font-size: 28px; font-weight: 800; text-align: center; margin-bottom: 20px; color: var(--accent);" data-i18n="whyUsSubtitle">Your Data. Your Control. Always.</h2>
                <p style="font-size: 16px; text-align: center; color: var(--text-secondary);" data-i18n="whyUsTagline">We built CloudNotes v1 on a simple principle: <strong>ultimate privacy and simplicity<strong>.</p>
                <div class="why-us-section">
                    
                    <div class="why-us-card">
                        <h4 data-i18n="privacyHeader">üîí Absolute Privacy</h4>
                        <p data-i18n="privacyBody">We <strong>don't track, collect, or sell any of your data<strong>. Everything you write or draw stays <strong>private<strong> on your device's local storage. This is a local-first application. Big companies (Giants) <strong>sell storage and integration. (your data too!).<strong> <strong>We (CloudeNotes) sell privacy, simplity, and vibe. <strong> Our prices are avalaible for <strong>Everyone<strong> </p>
                    </div>

                    <div class="why-us-card">
                        <h4 data-i18n="noAccountsHeader">üö´ Zero Accounts</h4>
                        <p data-i18n="noAccountsBody">No need for email, usernames, or passwords. <strong>No sign-ups<strong>, no log-ins, and no cloud storage required. Just open the app and start noting.</p>
                    </div>

                    <div class="why-us-card">
                        <h4 data-i18n="fastHeader">‚ö°Ô∏è Fast & Reliable</h4>
                        <p data-i18n="fastBody">Since your notes are stored <strong>locally<strong> on your browser, loading is instantaneous. You're never dependent on a network connection or server status.</p>
                    </div>

                    <div class="why-us-card">
                        <h4 data-i18n="editorHeader">üìù Feature-Rich Editor</h4>
                        <p data-i18n="editorBody">Our editor includes <strong>rich text options<strong>, a full <strong>drawing canvas<strong>, and the ability to add <strong>attachments<strong>, all while keeping your data private and local.</p>
                    </div>

                </div>
                <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border);">
                    <p style="font-size: 14px; color: var(--text-primary); font-weight: 600;" data-i18n="whyUsFooter">CloudNotes v1: Simple, powerful, and truly private note-taking.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="upgradeModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <div class="modal-title" data-i18n="upgradeModalTitle">üöÄ Upgrade to CloudNotes Pro</div>
                <button class="close-btn" onclick="closeUpgradeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <h2 style="font-size: 28px; font-weight: 800; text-align: center; margin-bottom: 20px; color: var(--accent);" data-i18n="upgradeSubtitle">Get the Full CloudNotes v1 Experience!</h2>
                <p style="font-size: 16px; text-align: center; color: var(--text-secondary);" data-i18n="upgradeTagline">Unlock Pro features while maintaining **ultimate privacy and simplicity**.</p>
                <div class="why-us-section">
                    
                    <div class="why-us-card">
                        <h4 data-i18n="privacyHeader">üîí Absolute Privacy</h4>
                        <p data-i18n="privacyBody">We <strong>don't track, collect, or sell any of your data<strong>. Everything you write or draw stays <strong>private<strong> on your device's local storage. This is a local-first application. Big companies (Giants) <strong>sell storage and integration. (your data too!).<strong> <strong>We (CloudeNotes) sell privacy, simplity, and vibe. <strong> Our prices are avalaible for <strong>Everyone<strong> </p>
                    </div>

                    <div class="why-us-card">
                        <h4 data-i18n="noAccountsHeader">üö´ Zero Accounts</h4>
                        <p data-i18n="noAccountsBody">No need for email, usernames, or passwords. <strong>No sign-ups<strong>, no log-ins, and no cloud storage required. Just open the app and start noting.</p>
                    </div>

                    <div class="why-us-card">
                        <h4 data-i18n="fastHeader">‚ö°Ô∏è Fast & Reliable</h4>
                        <p data-i18n="fastBody">Since your notes are stored <strong>locally<strong> on your browser, loading is instantaneous. You're never dependent on a network connection or server status.</p>
                    </div>

                    <div class="why-us-card">
                        <h4 data-i18n="editorHeader">üìù Feature-Rich Editor</h4>
                        <p data-i18n="editorBody">Our editor includes <strong>rich text options<strong>, a full <strong>drawing canvas<strong>, and the ability to add <strong>attachments<strong>, all while keeping your data private and local.</p>
                    </div>
                </div>

                <h2 style="font-size: 28px; font-weight: 800; text-align: center; margin-top: 60px; margin-bottom: 30px; color: var(--accent);" data-i18n="pricingTitle">Simple & Affordable Pricing</h2>
                <div class="upgrade-pricing">
                    <div class="price-card">
                        <div class="plan-title" data-i18n="proMonthlyTitle">Pro Monthly</div>
                        <div class="plan-price" data-i18n="proMonthlyPrice">$3.49</div>
                        <div class="plan-duration" data-i18n="proMonthlyDuration">per month</div>
                        <div class="plan-details" data-i18n="proMonthlyCancel">*cancel anytime</div>
                        <button class="buy-btn" data-i18n="chooseMonthlyBtn" onclick="alert('Proceed to checkout for Monthly Plan')">Choose Monthly</button>
                    </div>
                    
                    <div class="price-card annual">
                        <div class="plan-title" data-i18n="proAnnualTitle">Pro Annual</div>
                        <div class="save-badge" data-i18n="saveBadge">üî• Save 59%</div>
                        <div class="plan-price" data-i18n="proAnnualPrice">$24.99</div>
                        <div class="plan-duration" data-i18n="proAnnualDuration">per year (Billed Annually)</div>
                        <div class="plan-details" data-i18n="proMonthlyCancel">*cancel anytime</div>
                        <button class="buy-btn" style="background: var(--warning); color: var(--text-primary);" data-i18n="chooseAnnualBtn" onclick="alert('Proceed to checkout for Annual Plan')">Choose Annual</button>
                    </div>
                </div>

                <h2 style="font-size: 24px; font-weight: 700; text-align: center; margin-top: 40px; margin-bottom: 20px; color: var(--text-primary);" data-i18n="comparisonTitle">Free vs. Pro Comparison</h2>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th data-i18n="featureCol">Feature</th>
                            <th data-i18n="freePlanCol">Free Plan</th>
                            <th data-i18n="proPlanCol">Pro Plan</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-i18n="maxFolders">Maximum Folders</td>
                            <td class="free-feature" data-i18n="freeFolders">Up to 5 folders</td>
                            <td class="pro-feature" data-i18n="proFolders">Up to 25 folders</td>
                        </tr>
                        <tr>
                            <td data-i18n="maxNotes">Maximum Notes per Folder</td>
                            <td class="free-feature" data-i18n="freeNotes">5 notes max</td>
                            <td class="pro-feature" data-i18n="proNotes">100 notes max</td>
                        </tr>
                        <tr>
                            <td data-i18n="geminiRequests">Gemini AI Requests (per week)</td>
                            <td class="free-feature" data-i18n="freeGemini">3 requests</td>
                            <td class="pro-feature" data-i18n="proGemini">Up to 100 requests</td>
                        </tr>
                        <tr>
                            <td data-i18n="customIcons">Custom Icons</td>
                            <td class="no-feature" data-i18n="freeIcons">No custom icons</td>
                            <td class="pro-feature" data-i18n="proIcons">‚úÖ Custom Icons</td>
                        </tr>
                        <tr>
                            <td data-i18n="customBackgrounds">Custom Backgrounds</td>
                            <td class="no-feature" data-i18n="freeBackgrounds">No custom backgrounds</td>
                            <td class="pro-feature" data-i18n="proBackgrounds">‚úÖ Custom Backgrounds</td>
                        </tr>
                        <tr>
                            <td data-i18n="fileSupport">File Support (.wav, .zip, etc.)</td>
                            <td class="no-feature" data-i18n="freeFiles">No .waw files supported</td>
                            <td class="pro-feature" data-i18n="proFiles">‚úÖ Almost all type of files are supported</td>
                        </tr>
                    </tbody>
                </table>

                <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border);">
                    <p style="font-size: 14px; color: var(--text-primary); font-weight: 600;" data-i18n="upgradeFooter">Upgrade to Pro and make CloudNotes v1 truly unlimited.</p>
                </div>
            </div>
        </div>
    </div>
    <script>
        // --- START INTERNATIONALIZATION (I18N) ---
        const TRANSLATIONS = {
            'en': {
                // Sidebar & Toolbar
                'appTitle': 'CloudNotes v1',
                'appAuthor': 'by Niko',
                'whyUsBtn': 'Why Us?',
                'upgradeBtn': '‚ú® Upgrade to Pro',
                'folderBtn': '+ Folder',
                'newNoteIcon': 'üìù',
                'totalNotesLabel': 'Total Notes',
                'searchPlaceholder': 'Search notes...',

                // Notes & Editor
                'emptySelectFolder': 'Select a folder or create a new note',
                'newNoteTitle': 'New Note',
                'noteTitlePlaceholder': '‚ú® Note title...',
                'noteContentPlaceholder': '‚úçÔ∏è Start writing your amazing ideas...',
                'drawBtn': 'üé® Draw',
                'imageBtn': 'üñºÔ∏è Image',
                'fileBtn': 'üìé File',
                'pasteClipboardBtn': 'üìã Paste Clipboard',
                'bookmarkBtn': '‚≠ê Bookmark',
                'bookmarkedBtn': 'üåü Bookmarked',
                'saveNoteBtn': 'üíæ Save Note',
                'clearCanvasBtn': 'üóëÔ∏è Clear',
                'saveDrawingBtn': 'üíæ Save Drawing',
                'drawingStatusReady': 'Ready',
                'drawingStatusDrawing': 'Drawing...',
                'drawingStatusLoaded': 'Drawing loaded.',
                'drawingStatusSaved': 'Drawing saved!',
                'clipboardTitle': 'üìã Clipboard Content',
                'insertClipboardBtn': '‚ú® Insert into Note',
                'attachmentsTitle': 'üìé Attachments',
                'noteBadge': 'Note',
                'bookmarkedBadge': '‚≠ê Bookmarked',
                'saveIndicator': '‚úÖ Saved!',
                'noteNotFound': 'Folder not found.',
                'noNotesYet': 'No notes yet. Create your first note!',
                'searchEmpty': 'No notes found matching ',
                'alertFolderEmpty': 'Folder name cannot be empty!',
                'alertNoFolderSelected': 'No folder selected!',
                'alertTitleEmpty': 'Title cannot be empty!',
                'alertClipboardEmpty': 'Clipboard is empty! ',
                'alertClipboardError': 'Could not access clipboard. Please make sure you granted permission.',
                'alertDeleteConfirm': 'Are you sure you want to delete this attachment?',
                'alertSelectFolder': 'Please select a folder first or create a new one!',
                'brushSizeLabel': 'Brush Size:',

                // Folder Modal
                'newFolderTitle': '‚ú® New Folder',
                'folderNamePlaceholder': 'üìÅ Folder name...',
                'colorTitle': 'üé® Choose Icon Color',
                'createFolderBtn': '‚ú® Create Folder',
                
                // Why Us Modal
                'whyUsModalTitle': 'üåü Why Choose CloudNotes v1?',
                'whyUsSubtitle': 'Your Data. Your Control. Always.',
                'whyUsTagline': 'We built CloudNotes v1 on a simple principle: **ultimate privacy and simplicity**.',
                'privacyHeader': 'üîí Absolute Privacy',
                'privacyBody': 'We **don\'t track, collect, or sell any of your data**. Everything you write or draw stays **private** on your device\'s local storage. This is a local-first application. Big companies (Giants) **sell storage and integration. (your data too!)**. **We (CloudeNotes) sell privacy, simplity, and vibe.** Our prices are avalaible for **Everyone**',
                'noAccountsHeader': 'üö´ Zero Accounts',
                'noAccountsBody': 'No need for email, usernames, or passwords. **No sign-ups**, no log-ins, and no cloud storage required. Just open the app and start noting.',
                'fastHeader': '‚ö°Ô∏è Fast & Reliable',
                'fastBody': 'Since your notes are stored **locally** on your browser, loading is instantaneous. You\'re never dependent on a network connection or server status.',
                'editorHeader': 'üìù Feature-Rich Editor',
                'editorBody': 'Our editor includes **rich text options**, a full **drawing canvas**, and the ability to add **attachments**, all while keeping your data private and local.',
                'whyUsFooter': 'CloudNotes v1: Simple, powerful, and truly private note-taking.',
                
                // Upgrade Modal
                'upgradeModalTitle': 'üöÄ Upgrade to CloudNotes Pro',
                'upgradeSubtitle': 'Get the Full CloudNotes v1 Experience!',
                'upgradeTagline': 'Unlock Pro features while maintaining **ultimate privacy and simplicity**.',
                'pricingTitle': 'Simple & Affordable Pricing',
                'proMonthlyTitle': 'Pro Monthly',
                'proMonthlyPrice': '$3.49',
                'proMonthlyDuration': 'per month',
                'proMonthlyCancel': '*cancel anytime',
                'chooseMonthlyBtn': 'Choose Monthly',
                'proAnnualTitle': 'Pro Annual',
                'saveBadge': 'üî• Save 59%',
                'proAnnualPrice': '$24.99',
                'proAnnualDuration': 'per year (Billed Annually)',
                'chooseAnnualBtn': 'Choose Annual',
                'comparisonTitle': 'Free vs. Pro Comparison',
                'featureCol': 'Feature',
                'freePlanCol': 'Free Plan',
                'proPlanCol': 'Pro Plan',
                'maxFolders': 'Maximum Folders',
                'maxNotes': 'Maximum Notes per Folder',
                'geminiRequests': 'Gemini AI Requests (per week)',
                'customIcons': 'Custom Icons',
                'customBackgrounds': 'Custom Backgrounds',
                'fileSupport': 'File Support (.wav, .zip, etc.)',
                'freeFolders': 'Up to 5 folders',
                'proFolders': 'Up to 25 folders',
                'freeNotes': '5 notes max',
                'proNotes': '100 notes max',
                'freeGemini': '3 requests',
                'proGemini': 'Up to 100 requests',
                'freeIcons': 'No custom icons',
                'proIcons': '‚úÖ Custom Icons',
                'freeBackgrounds': 'No custom backgrounds',
                'proBackgrounds': '‚úÖ Custom Backgrounds',
                'freeFiles': 'No .waw files supported',
                'proFiles': '‚úÖ Almost all type of files are supported',
                'upgradeFooter': 'Upgrade to Pro and make CloudNotes v1 truly unlimited.',
            },
            'ru': {
                // Sidebar & Toolbar
                'appTitle': 'CloudNotes v1',
                'appAuthor': '–æ—Ç Niko',
                'whyUsBtn': '–ü–æ—á–µ–º—É –º—ã?',
                'upgradeBtn': '‚ú® –û–±–Ω–æ–≤–∏—Ç—å –¥–æ Pro',
                'folderBtn': '+ –ü–∞–ø–∫–∞',
                'newNoteIcon': 'üìù',
                'totalNotesLabel': '–í—Å–µ–≥–æ –∑–∞–º–µ—Ç–æ–∫',
                'searchPlaceholder': '–ò—Å–∫–∞—Ç—å –∑–∞–º–µ—Ç–∫–∏...',
                
                // Notes & Editor
                'emptySelectFolder': '–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É',
                'newNoteTitle': '–ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞',
                'noteTitlePlaceholder': '‚ú® –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–º–µ—Ç–∫–∏...',
                'noteContentPlaceholder': '‚úçÔ∏è –ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å —Å–≤–æ–∏ –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–µ –∏–¥–µ–∏...',
                'drawBtn': 'üé® –†–∏—Å–æ–≤–∞—Ç—å',
                'imageBtn': 'üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',
                'fileBtn': 'üìé –§–∞–π–ª',
                'pasteClipboardBtn': 'üìã –í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞',
                'bookmarkBtn': '‚≠ê –í –∑–∞–∫–ª–∞–¥–∫–∏',
                'bookmarkedBtn': 'üåü –í –∑–∞–∫–ª–∞–¥–∫–∞—Ö',
                'saveNoteBtn': 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É',
                'clearCanvasBtn': 'üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å',
                'saveDrawingBtn': 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∏—Å—É–Ω–æ–∫',
                'drawingStatusReady': '–ì–æ—Ç–æ–≤',
                'drawingStatusDrawing': '–†–∏—Å—É–µ–º...',
                'drawingStatusLoaded': '–†–∏—Å—É–Ω–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω.',
                'drawingStatusSaved': '–†–∏—Å—É–Ω–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!',
                'clipboardTitle': 'üìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞',
                'insertClipboardBtn': '‚ú® –í—Å—Ç–∞–≤–∏—Ç—å –≤ –∑–∞–º–µ—Ç–∫—É',
                'attachmentsTitle': 'üìé –í–ª–æ–∂–µ–Ω–∏—è',
                'noteBadge': '–ó–∞–º–µ—Ç–∫–∞',
                'bookmarkedBadge': '‚≠ê –í –∑–∞–∫–ª–∞–¥–∫–∞—Ö',
                'saveIndicator': '‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!',
                'noteNotFound': '–ü–∞–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.',
                'noNotesYet': '–ó–∞–º–µ—Ç–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–º–µ—Ç–∫—É!',
                'searchEmpty': '–ó–∞–º–µ—Ç–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É ',
                'alertFolderEmpty': '–ò–º—è –ø–∞–ø–∫–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!',
                'alertNoFolderSelected': '–ü–∞–ø–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞!',
                'alertTitleEmpty': '–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!',
                'alertClipboardEmpty': '–ë—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –ø—É—Å—Ç!',
                'alertClipboardError': '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –±—É—Ñ–µ—Ä—É. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ.',
                'alertDeleteConfirm': '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –≤–ª–æ–∂–µ–Ω–∏–µ?',
                'alertSelectFolder': '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é!',
                'brushSizeLabel': '–†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏:',

                // Folder Modal
                'newFolderTitle': '‚ú® –ù–æ–≤–∞—è –ø–∞–ø–∫–∞',
                'folderNamePlaceholder': 'üìÅ –ò–º—è –ø–∞–ø–∫–∏...',
                'colorTitle': 'üé® –í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –∏–∫–æ–Ω–∫–∏',
                'createFolderBtn': '‚ú® –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É',

                // Why Us Modal
                'whyUsModalTitle': 'üåü –ü–æ—á–µ–º—É CloudNotes v1?',
                'whyUsSubtitle': '–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ. –í–∞—à –∫–æ–Ω—Ç—Ä–æ–ª—å. –í—Å–µ–≥–¥–∞.',
                'whyUsTagline': '–ú—ã —Å–æ–∑–¥–∞–ª–∏ CloudNotes v1 –ø–æ –ø—Ä–æ—Å—Ç–æ–º—É –ø—Ä–∏–Ω—Ü–∏–ø—É: **–∞–±—Å–æ–ª—é—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Å—Ç–æ—Ç–∞**.',
                'privacyHeader': 'üîí –ê–±—Å–æ–ª—é—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å',
                'privacyBody': '–ú—ã **–Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º, –Ω–µ —Å–æ–±–∏—Ä–∞–µ–º –∏ –Ω–µ –ø—Ä–æ–¥–∞–µ–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ**. –í—Å–µ, —á—Ç–æ –≤—ã –ø–∏—à–µ—Ç–µ –∏–ª–∏ —Ä–∏—Å—É–µ—Ç–µ, –æ—Å—Ç–∞–µ—Ç—Å—è **–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º** –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤–∞—à–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ. –ö—Ä—É–ø–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ (–ì–∏–≥–∞–Ω—Ç—ã) **–ø—Ä–æ–¥–∞—é—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é. (–∏ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ!)**. **–ú—ã (CloudeNotes) –ø—Ä–æ–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ—Ç—É –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É.** –ù–∞—à–∏ —Ü–µ–Ω—ã –¥–æ—Å—Ç—É–ø–Ω—ã **–ö–∞–∂–¥–æ–º—É**',
                'noAccountsHeader': 'üö´ –ù—É–ª–µ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã',
                'noAccountsBody': '–ù–µ –Ω—É–∂–Ω—ã —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞, –ª–æ–≥–∏–Ω—ã –∏–ª–∏ –ø–∞—Ä–æ–ª–∏. **–ù–∏–∫–∞–∫–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**, –≤—Ö–æ–¥–∞ –∏ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –ü—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –Ω–∞—á–Ω–∏—Ç–µ –¥–µ–ª–∞—Ç—å –∑–∞–º–µ—Ç–∫–∏.',
                'fastHeader': '‚ö°Ô∏è –ë—ã—Å—Ç—Ä–æ –∏ –Ω–∞–¥–µ–∂–Ω–æ',
                'fastBody': '–ü–æ—Å–∫–æ–ª—å–∫—É –≤–∞—à–∏ –∑–∞–º–µ—Ç–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è **–ª–æ–∫–∞–ª—å–Ω–æ** –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ, –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ. –í—ã –Ω–µ –∑–∞–≤–∏—Å–∏—Ç–µ –æ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ç–∏ –∏–ª–∏ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞.',
                'editorHeader': 'üìù –ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä',
                'editorBody': '–ù–∞—à —Ä–µ–¥–∞–∫—Ç–æ—Ä –≤–∫–ª—é—á–∞–µ—Ç **—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ–ø—Ü–∏–∏**, –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π **—Ö–æ–ª—Å—Ç –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è** –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª—è—Ç—å **–≤–ª–æ–∂–µ–Ω–∏—è**, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–º–∏.',
                'whyUsFooter': 'CloudNotes v1: –ü—Ä–æ—Å—Ç–æ–µ, –º–æ—â–Ω–æ–µ –∏ –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫.',
                
                // Upgrade Modal
                'upgradeModalTitle': 'üöÄ –û–±–Ω–æ–≤–∏—Ç—å –¥–æ CloudNotes Pro',
                'upgradeSubtitle': '–ü–æ–ª—É—á–∏—Ç–µ –ø–æ–ª–Ω—ã–π –æ–ø—ã—Ç CloudNotes v1!',
                'upgradeTagline': '–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ Pro-—Ñ—É–Ω–∫—Ü–∏–∏, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º **–∞–±—Å–æ–ª—é—Ç–Ω—É—é –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Å—Ç–æ—Ç—É**.',
                'pricingTitle': '–ü—Ä–æ—Å—Ç—ã–µ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ü–µ–Ω—ã',
                'proMonthlyTitle': 'Pro –ï–∂–µ–º–µ—Å—è—á–Ω–æ',
                'proMonthlyPrice': '$3.49',
                'proMonthlyDuration': '–≤ –º–µ—Å—è—Ü',
                'proMonthlyCancel': '*–æ—Ç–º–µ–Ω–∞ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è',
                'chooseMonthlyBtn': '–í—ã–±—Ä–∞—Ç—å –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π',
                'proAnnualTitle': 'Pro –ì–æ–¥–æ–≤–æ–π',
                'saveBadge': 'üî• –°—ç–∫–æ–Ω–æ–º—å—Ç–µ 59%',
                'proAnnualPrice': '$24.99',
                'proAnnualDuration': '–≤ –≥–æ–¥ (–æ–ø–ª–∞—Ç–∞ —Ä–∞–∑ –≤ –≥–æ–¥)',
                'chooseAnnualBtn': '–í—ã–±—Ä–∞—Ç—å –≥–æ–¥–æ–≤–æ–π',
                'comparisonTitle': '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ Free –∏ Pro',
                'featureCol': '–§—É–Ω–∫—Ü–∏—è',
                'freePlanCol': '–ü–ª–∞–Ω Free',
                'proPlanCol': '–ü–ª–∞–Ω Pro',
                'maxFolders': '–ú–∞–∫—Å–∏–º—É–º –ø–∞–ø–æ–∫',
                'maxNotes': '–ú–∞–∫—Å–∏–º—É–º –∑–∞–º–µ—Ç–æ–∫ –≤ –ø–∞–ø–∫–µ',
                'geminiRequests': '–ó–∞–ø—Ä–æ—Å—ã Gemini AI (–≤ –Ω–µ–¥–µ–ª—é)',
                'customIcons': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏–∫–æ–Ω–∫–∏',
                'customBackgrounds': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–æ–Ω—ã',
                'fileSupport': '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–π–ª–æ–≤ (.wav, .zip, –∏ —Ç.–¥.)',
                'freeFolders': '–î–æ 5 –ø–∞–ø–æ–∫',
                'proFolders': '–î–æ 25 –ø–∞–ø–æ–∫',
                'freeNotes': '–ú–∞–∫—Å–∏–º—É–º 5 –∑–∞–º–µ—Ç–æ–∫',
                'proNotes': '–ú–∞–∫—Å–∏–º—É–º 100 –∑–∞–º–µ—Ç–æ–∫',
                'freeGemini': '3 –∑–∞–ø—Ä–æ—Å–∞',
                'proGemini': '–î–æ 100 –∑–∞–ø—Ä–æ—Å–æ–≤',
                'freeIcons': '–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏–∫–æ–Ω–æ–∫',
                'proIcons': '‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏–∫–æ–Ω–∫–∏',
                'freeBackgrounds': '–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ–æ–Ω–æ–≤',
                'proBackgrounds': '‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–æ–Ω—ã',
                'freeFiles': '–§–∞–π–ª—ã .waw –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è',
                'proFiles': '‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø–æ—á—Ç–∏ –≤—Å–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤',
                'upgradeFooter': '–û–±–Ω–æ–≤–∏—Ç–µ—Å—å –¥–æ Pro –∏ —Å–¥–µ–ª–∞–π—Ç–µ CloudNotes v1 –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –±–µ–∑–ª–∏–º–∏—Ç–Ω—ã–º.',
            }
        };

        let currentLanguage = 'en'; // Default language

        // Helper function to get translation from inside functions
        function _T(key) {
            return TRANSLATIONS[currentLanguage][key] || TRANSLATIONS['en'][key] || key;
        }

        function applyTranslations(lang) {
            const translation = TRANSLATIONS[lang];
            if (!translation) return;

            // Static text elements
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translation[key]) {
                    if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                        element.setAttribute('placeholder', translation[key]);
                    } else if (element.tagName === 'TEXTAREA' && element.hasAttribute('placeholder')) {
                        element.setAttribute('placeholder', translation[key]);
                    } else if (element.tagName === 'DIV' && element.classList.contains('stat-label')) {
                        element.textContent = translation[key]; // Use textContent for plain labels
                    } else {
                        // For rich content like titles and body text, use innerHTML
                        element.innerHTML = translation[key];
                    }
                }
            });
            
            // Update the dynamic editor label
            document.querySelector('.canvas-toolbar label').textContent = _T('brushSizeLabel');
        }

        function switchLanguage(lang) {
            currentLanguage = lang;
            document.documentElement.lang = lang;
            
            // Set the dropdown to the correct language (if it exists)
            const langSelect = document.getElementById('langSelect');
            if (langSelect) langSelect.value = lang;

            applyTranslations(lang);
            
            // Save language setting
            localStorage.setItem('cloudNotesLang', lang);

            // Re-render notes/folders to update dynamic text like badges and empty states
            renderFolders();
            if (data.currentFolder) {
                renderNotes(data.currentFolder);
            } else {
                // Ensure empty state is translated if no folder is selected
                document.getElementById('contentArea').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìù</div>
                        <div class="empty-text">${_T('emptySelectFolder')}</div>
                    </div>
                `;
            }
        }
        // --- END INTERNATIONALIZATION (I18N) ---
        
        // Data structure
        let data = {
            folders: [
                { id: 1, name: 'Work', color: '#6366f1', notes: [] },
                { id: 2, name: 'Home', color: '#10b981', notes: [] },
                { id: 3, name: 'Fun Projects :)', color: '#f59e0b', notes: [] }
            ],
            currentFolder: null,
            currentNote: null,
            nextFolderId: 4,
            nextNoteId: 1
        };

        let canvas, ctx, isDrawing = false;
        let selectedColor = '#6366f1';
        let drawingData = null;
        let currentBookmark = false;
        let clipboardContent = '';

        // Initialize
        function init() {
            // Load language preference first and apply translations
            const savedLang = localStorage.getItem('cloudNotesLang') || 'en';
            switchLanguage(savedLang); 
            
            loadData();
            renderFolders();
            setupCanvas();
            updateTotalNotes();
        }

        // Theme toggle
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', newTheme);
            document.getElementById('themeToggle').textContent = newTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            saveData();
        }
        
        // Why Us Modal
        function openWhyUsModal() {
            document.getElementById('whyUsModal').classList.add('active');
        }

        function closeWhyUsModal() {
            document.getElementById('whyUsModal').classList.remove('active');
        }

        // Upgrade Modal
        function openUpgradeModal() {
            document.getElementById('upgradeModal').classList.add('active');
        }

        function closeUpgradeModal() {
            document.getElementById('upgradeModal').classList.remove('active');
        }

        // Update total notes count
        function updateTotalNotes() {
            let total = 0;
            data.folders.forEach(folder => {
                total += folder.notes.length;
            });
            document.getElementById('totalNotes').textContent = total;
            document.getElementById('totalNotesLabel').textContent = _T('totalNotesLabel'); // Ensure label is translated
        }

        // Clipboard functions
        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                if (text) {
                    clipboardContent = text;
                    document.getElementById('clipboardSection').style.display = 'block';
                    document.getElementById('clipboardPreview').textContent = text.substring(0, 200) + (text.length > 200 ? '...' : '');
                } else {
                    alert(_T('alertClipboardEmpty'));
                }
            } catch (err) {
                alert(_T('alertClipboardError'));
            }
        }

        function insertClipboard() {
            const editor = document.getElementById('noteContent');
            const currentContent = editor.value;
            editor.value = currentContent + (currentContent ? '\n\n' : '') + clipboardContent;
            document.getElementById('clipboardSection').style.display = 'none';
        }

        // Folders
        function renderFolders() {
            const container = document.getElementById('foldersContainer');
            container.innerHTML = '';
            
            data.folders.forEach(folder => {
                const item = document.createElement('div');
                item.className = 'folder-item';
                if (data.currentFolder === folder.id) item.classList.add('active');
                item.innerHTML = `
                    <div class="folder-icon" style="background: ${folder.color};">üìÅ</div>
                    <div class="folder-name">${folder.name}</div>
                    <div class="folder-count">${folder.notes.length}</div>
                `;
                item.onclick = () => selectFolder(folder.id);
                container.appendChild(item);
            });
        }

        function selectFolder(id) {
            data.currentFolder = id;
            data.currentNote = null;
            renderFolders();
            renderNotes(id);
            saveData();
        }

        function createFolder() {
            document.getElementById('folderName').value = '';
            // Reset color selection
            document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
            const defaultColor = document.querySelector('.color-picker-container div');
            defaultColor.classList.add('selected');
            selectedColor = defaultColor.getAttribute('data-color');
            
            document.getElementById('folderModal').classList.add('active');
        }

        function closeFolderModal() {
            document.getElementById('folderModal').classList.remove('active');
        }

        function selectColor(element) {
            document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            selectedColor = element.getAttribute('data-color');
        }

        function saveFolderModal() {
            const name = document.getElementById('folderName').value.trim();
            if (!name) {
                alert(_T('alertFolderEmpty'));
                return;
            }

            const newFolder = {
                id: data.nextFolderId++,
                name: name,
                color: selectedColor,
                notes: []
            };

            data.folders.push(newFolder);
            closeFolderModal();
            renderFolders();
            saveData();
        }

        // Notes
        function renderNotes(folderId) {
            const contentArea = document.getElementById('contentArea');
            const folder = data.folders.find(f => f.id === folderId);

            if (!folder) {
                contentArea.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <div class="empty-text">${_T('noteNotFound')}</div>
                    </div>
                `;
                return;
            }

            if (folder.notes.length === 0) {
                contentArea.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ú®</div>
                        <div class="empty-text">${_T('noNotesYet')}</div>
                    </div>
                `;
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'notes-grid';

            folder.notes.forEach(note => {
                const card = document.createElement('div');
                card.className = 'note-card';
                
                // Add note ID for opening the modal
                card.onclick = () => openNoteModal(note.id);
                
                const badgeText = note.isBookmarked ? _T('bookmarkedBadge') : _T('noteBadge');

                card.innerHTML = `
                    ${note.isBookmarked ? '<button class="bookmark-btn bookmarked" onclick="event.stopPropagation();">üåü</button>' : ''}
                    <h3 class="note-title">${note.title}</h3>
                    <p class="note-preview">${note.content.substring(0, 100)}...</p>
                    <div class="note-meta">
                        <span>üìÖ ${new Date(note.updatedAt).toLocaleDateString()}</span>
                        <span class="note-badge" style="background: ${folder.color}1A; color: ${folder.color};">${badgeText}</span>
                    </div>
                `;
                grid.appendChild(card);
            });

            contentArea.innerHTML = '';
            contentArea.appendChild(grid);
        }
        
        function openNewNote() {
            data.currentNote = null;
            document.getElementById('modalTitle').textContent = _T('newNoteTitle');
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').value = '';
            document.getElementById('fontFamily').value = 'Arial';
            document.getElementById('fontSize').value = 16;
            updateEditorStyle(); // Reset editor style

            // Reset drawing canvas
            const canvasContainer = document.getElementById('canvasContainer');
            canvasContainer.style.display = 'none';
            if (drawingData) {
                clearCanvas(false);
            }
            drawingData = null;

            // Reset attachments
            renderAttachments([]);

            // Reset bookmark
            currentBookmark = false;
            updateBookmarkButton();

            // Hide clipboard
            document.getElementById('clipboardSection').style.display = 'none';

            if (!data.currentFolder) {
                alert(_T('alertSelectFolder'));
                return;
            }

            document.getElementById('noteModal').classList.add('active');
        }

        function openNoteModal(noteId) {
            const folder = data.folders.find(f => f.id === data.currentFolder);
            const note = folder.notes.find(n => n.id === noteId);

            if (!note) return;

            data.currentNote = noteId;

            document.getElementById('modalTitle').textContent = note.title;
            document.getElementById('noteTitle').value = note.title;
            document.getElementById('noteContent').value = note.content;
            document.getElementById('fontFamily').value = note.fontFamily || 'Arial';
            document.getElementById('fontSize').value = note.fontSize || 16;
            updateEditorStyle();

            drawingData = note.drawing || null;
            currentBookmark = note.isBookmarked || false;
            updateBookmarkButton();

            renderAttachments(note.attachments);

            document.getElementById('canvasContainer').style.display = drawingData ? 'block' : 'none';
            if (drawingData) {
                setTimeout(() => loadDrawing(drawingData), 50); // Small delay for canvas to be visible
            }

            document.getElementById('clipboardSection').style.display = 'none';
            document.getElementById('noteModal').classList.add('active');
        }

        function closeNoteModal() {
            document.getElementById('noteModal').classList.remove('active');
            // Re-render notes to show changes if any (e.g., if a note was saved)
            if (data.currentFolder) {
                renderNotes(data.currentFolder);
            }
            data.currentNote = null;
        }

        function saveNote() {
            const title = document.getElementById('noteTitle').value.trim();
            const content = document.getElementById('noteContent').value.trim();
            const fontFamily = document.getElementById('fontFamily').value;
            const fontSize = parseInt(document.getElementById('fontSize').value);
            const folder = data.folders.find(f => f.id === data.currentFolder);
            
            if (!folder) {
                alert(_T('alertNoFolderSelected'));
                return;
            }

            if (!title) {
                alert(_T('alertTitleEmpty'));
                return;
            }

            // Get current attachments from grid
            const attachments = [];
            document.querySelectorAll('#attachmentsGrid .attachment-item').forEach(item => {
                attachments.push({
                    name: item.querySelector('.attachment-name').textContent,
                    type: item.dataset.type,
                    dataUrl: item.dataset.data
                });
            });

            const newNoteData = {
                title,
                content,
                fontFamily,
                fontSize,
                drawing: drawingData,
                isBookmarked: currentBookmark,
                attachments: attachments,
                updatedAt: new Date().toISOString()
            };

            if (data.currentNote === null) {
                // New note
                newNoteData.id = data.nextNoteId++;
                newNoteData.createdAt = newNoteData.updatedAt;
                folder.notes.push(newNoteData);
            } else {
                // Edit existing note
                const noteIndex = folder.notes.findIndex(n => n.id === data.currentNote);
                if (noteIndex !== -1) {
                    folder.notes[noteIndex] = { ...folder.notes[noteIndex], ...newNoteData };
                }
            }

            saveData();
            updateTotalNotes();

            // Show save indicator
            const saveIndicator = document.createElement('div');
            saveIndicator.className = 'save-indicator';
            saveIndicator.innerHTML = _T('saveIndicator');
            document.body.appendChild(saveIndicator);
            setTimeout(() => saveIndicator.remove(), 1500);

            closeNoteModal();
        }

        function updateEditorStyle() {
            const editor = document.getElementById('noteContent');
            editor.style.fontFamily = document.getElementById('fontFamily').value;
            editor.style.fontSize = document.getElementById('fontSize').value + 'px';
        }
        
        function toggleBookmark() {
            currentBookmark = !currentBookmark;
            updateBookmarkButton();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            if (currentBookmark) {
                btn.classList.add('bookmarked');
                btn.innerHTML = 'üåü ' + _T('bookmarkedBtn');
            } else {
                btn.classList.remove('bookmarked');
                btn.innerHTML = '‚≠ê ' + _T('bookmarkBtn');
            }
        }


        // Attachments
        function renderAttachments(attachments) {
            const grid = document.getElementById('attachmentsGrid');
            grid.innerHTML = '';
            
            attachments.forEach((attachment, index) => {
                const item = document.createElement('div');
                item.className = 'attachment-item';
                item.dataset.type = attachment.type;
                item.dataset.data = attachment.dataUrl;
                item.innerHTML = `
                    <div class="attachment-icon">${getAttachmentIcon(attachment.type)}</div>
                    <div class="attachment-name">${attachment.name}</div>
                    <button style="position: absolute; top: 0; right: 0; background: var(--danger); color: white; border: none; padding: 4px 8px; border-radius: 0 12px 0 8px; cursor: pointer;" onclick="event.stopPropagation(); deleteAttachment(${index});">X</button>
                `;
                item.onclick = () => viewAttachment(attachment.dataUrl, attachment.name, attachment.type);
                grid.appendChild(item);
            });
        }
        // (addImage, addFile, getFileType, getAttachmentIcon functions remain the same)
        function addImage() {
            const files = document.getElementById('imageUpload').files;
            const note = data.currentNote !== null ? data.folders.find(f => f.id === data.currentFolder).notes.find(n => n.id === data.currentNote) : { attachments: [] };

            for (let file of files) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    note.attachments.push({ name: file.name, type: 'image', dataUrl: e.target.result });
                    renderAttachments(note.attachments);
                    saveData();
                };
                reader.readAsDataURL(file);
            }
        }

        function addFile() {
            const files = document.getElementById('fileUpload').files;
            const note = data.currentNote !== null ? data.folders.find(f => f.id === data.currentFolder).notes.find(n => n.id === data.currentNote) : { attachments: [] };

            for (let file of files) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    note.attachments.push({ name: file.name, type: getFileType(file.name), dataUrl: e.target.result });
                    renderAttachments(note.attachments);
                    saveData();
                };
                reader.readAsDataURL(file);
            }
        }

        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'gif', 'svg', 'webp'].includes(ext)) return 'image';
            if (['mp3', 'wav', 'ogg', 'm4a'].includes(ext)) return 'audio';
            if (['mp4', 'avi', 'mov', 'webm', 'mkv'].includes(ext)) return 'video';
            if (['exe', 'msi', 'app'].includes(ext)) return 'executable';
            if (['pdf', 'doc', 'docx', 'txt', 'rtf'].includes(ext)) return 'document';
            if (['zip', 'rar', '7z', 'tar'].includes(ext)) return 'archive';
            return 'file';
        }

        function getAttachmentIcon(type) {
            const icons = {
                image: 'üñºÔ∏è',
                audio: 'üéµ',
                video: 'üé¨',
                executable: '‚öôÔ∏è',
                document: 'üìÑ',
                archive: 'üì¶',
                file: 'üìé'
            };
            return icons[type] || 'üìé';
        }

        function deleteAttachment(index) {
            if (!confirm(_T('alertDeleteConfirm'))) return;
            const folder = data.folders.find(f => f.id === data.currentFolder);
            const note = folder.notes.find(n => n.id === data.currentNote);
            if (note && note.attachments) {
                note.attachments.splice(index, 1);
                renderAttachments(note.attachments);
                saveData();
            }
        }

        function viewAttachment(dataUrl, name, type) {
            if (type.startsWith('image')) {
                const newWindow = window.open();
                newWindow.document.write(`<img src="${dataUrl}" alt="${name}" style="max-width: 100%; display: block;">`);
            } else {
                // For other files, you can just download them
                const link = document.createElement('a');
                link.href = dataUrl;
                link.download = name;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // Drawing Canvas
        function setupCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            
            // Set initial canvas dimensions
            canvas.width = canvas.offsetWidth;
            canvas.height = 400; // Fixed height

            // Event listeners
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mousemove', draw);

            // Touch events
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startDrawing(e.touches[0]);
            });
            canvas.addEventListener('touchend', stopDrawing);
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                draw(e.touches[0]);
            });

            // Handle window resize (responsive canvas size)
            window.addEventListener('resize', () => {
                if (document.getElementById('canvasContainer').style.display === 'block') {
                    // Save drawing before resizing
                    saveDrawing(false); 
                    // Update dimensions
                    canvas.width = canvas.offsetWidth;
                    // Reload drawing
                    loadDrawing(drawingData);
                }
            });
        }

        function toggleDrawing() {
            const container = document.getElementById('canvasContainer');
            if (container.style.display === 'block') {
                container.style.display = 'none';
                saveDrawing(false); // Save before hiding
            } else {
                container.style.display = 'block';
                // Reset canvas dimensions for potential resize before loading
                canvas.width = canvas.offsetWidth;
                loadDrawing(drawingData); // Load previous drawing if available
            }
        }

        function startDrawing(e) {
            isDrawing = true;
            ctx.beginPath();
            ctx.moveTo(e.offsetX || e.clientX - canvas.getBoundingClientRect().left, e.offsetY || e.clientY - canvas.getBoundingClientRect().top);
            document.getElementById('drawingStatus').textContent = _T('drawingStatusDrawing');
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.closePath();
            document.getElementById('drawingStatus').textContent = _T('drawingStatusReady');
            // Auto-save the drawing data to state immediately after drawing stops
            drawingData = canvas.toDataURL(); 
        }

        function draw(e) {
            if (!isDrawing) return;

            // Get the current color and size
            ctx.strokeStyle = document.getElementById('drawColor').value;
            ctx.lineWidth = document.getElementById('drawSize').value;
            ctx.lineCap = 'round';

            // Draw the line
            ctx.lineTo(e.offsetX || e.clientX - canvas.getBoundingClientRect().left, e.offsetY || e.clientY - canvas.getBoundingClientRect().top);
            ctx.stroke();

            // Move the path to the current mouse position for the next segment
            ctx.beginPath();
            ctx.moveTo(e.offsetX || e.clientX - canvas.getBoundingClientRect().left, e.offsetY || e.clientY - canvas.getBoundingClientRect().top);
        }

        function clearCanvas(clearData = true) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (clearData) {
                drawingData = null;
                document.getElementById('drawingStatus').textContent = _T('drawingStatusCleared');
            }
        }

        function loadDrawing(dataUrl) {
            if (!dataUrl) {
                clearCanvas(false);
                return;
            }
            const img = new Image();
            img.onload = function() {
                // To maintain aspect ratio and proper positioning when loaded from saved data
                // Clear and then draw the image
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                document.getElementById('drawingStatus').textContent = _T('drawingStatusLoaded');
            };
            img.src = dataUrl;
        }

        function saveDrawing(showIndicator = true) {
            drawingData = canvas.toDataURL();
            if (showIndicator) {
                document.getElementById('drawingStatus').textContent = _T('drawingStatusSaved');
                setTimeout(() => document.getElementById('drawingStatus').textContent = _T('drawingStatusReady'), 1500);
            }
        }

        // Search function
        function searchNotes() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const contentArea = document.getElementById('contentArea');
            let allNotes = [];

            // Collect all notes from all folders and include folder color
            data.folders.forEach(folder => {
                folder.notes.forEach(note => {
                    allNotes.push({ ...note, folderColor: folder.color, folderId: folder.id });
                });
            });

            const filteredNotes = allNotes.filter(note => 
                note.title.toLowerCase().includes(searchTerm) || 
                note.content.toLowerCase().includes(searchTerm)
            );

            if (searchTerm === '') {
                // If search is empty, show the current folder or empty state
                if (data.currentFolder) {
                    renderNotes(data.currentFolder);
                } else {
                    contentArea.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üìù</div>
                            <div class="empty-text">${_T('emptySelectFolder')}</div>
                        </div>
                    `;
                }
                return;
            }

            if (filteredNotes.length === 0) {
                contentArea.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üîç</div>
                        <div class="empty-text">${_T('searchEmpty')}"${searchTerm}"</div>
                    </div>
                `;
                return;
            }

            // Render search results
            contentArea.innerHTML = `<div class="notes-grid">${filteredNotes.map(note => {
                const badgeText = note.isBookmarked ? _T('bookmarkedBadge') : _T('noteBadge');
                return `
                <div class="note-card" onclick="selectFolder(${note.folderId}); openNoteModal(${note.id});">
                    ${note.isBookmarked ? '<button class="bookmark-btn bookmarked" onclick="event.stopPropagation();">üåü</button>' : ''}
                    <h3 class="note-title">${note.title}</h3>
                    <p class="note-preview">${note.content.substring(0, 100)}...</p>
                    <div class="note-meta">
                        <span>üìÖ ${new Date(note.updatedAt).toLocaleDateString()}</span>
                        <span class="note-badge" style="background: ${note.folderColor}1A; color: ${note.folderColor};">${badgeText}</span>
                    </div>
                </div>
            `;
            }).join('')}</div>`;
        }

        // Local Storage
        function saveData() {
            try {
                const dataToSave = {
                    folders: data.folders,
                    currentFolder: data.currentFolder,
                    nextFolderId: data.nextFolderId,
                    nextNoteId: data.nextNoteId,
                    theme: document.body.getAttribute('data-theme')
                };
                localStorage.setItem('cloudNotesData', JSON.stringify(dataToSave));
            } catch (e) {
                // FIX: Removed the disruptive alert, now only logs to console
                console.error('Error saving data to local storage. Data may be lost on browser refresh:', e);
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('cloudNotesData');
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    data.folders = parsed.folders;
                    data.currentFolder = parsed.currentFolder;
                    data.nextFolderId = parsed.nextFolderId;
                    data.nextNoteId = parsed.nextNoteId;
                    
                    if (parsed.theme) {
                        document.body.setAttribute('data-theme', parsed.theme);
                        document.getElementById('themeToggle').textContent = 
                            parsed.theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
                    }
                }
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }

        // Initialize app
        init();
    </script>
</body>
</html>
